import pytest
from pydantic import ValidationError
from mitlist.core.config import Settings

def test_dev_token_enabled_in_production_raises_error():
    """
    Vulnerability Fix: Ensure Settings raises ValidationError if
    DEV_TEST_USER_ENABLED is True in production.
    """
    with pytest.raises(ValidationError) as excinfo:
        Settings(
            ENVIRONMENT="production",
            DEV_TEST_USER_ENABLED=True,
            POSTGRES_SERVER="localhost",
            POSTGRES_USER="postgres",
            POSTGRES_PASSWORD="password",
            POSTGRES_DB="mitlist",
            SECRET_KEY="testsecret"
        )

    assert "Security Risk: DEV_TEST_USER_ENABLED cannot be True in production environment." in str(excinfo.value)

def test_dev_token_enabled_in_local_is_allowed():
    """
    Ensure it is allowed in local environment.
    """
    settings = Settings(
        ENVIRONMENT="local",
        DEV_TEST_USER_ENABLED=True,
        POSTGRES_SERVER="localhost",
        POSTGRES_USER="postgres",
        POSTGRES_PASSWORD="password",
        POSTGRES_DB="mitlist",
        SECRET_KEY="testsecret"
    )
    assert settings.DEV_TEST_USER_ENABLED is True
